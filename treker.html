<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>21‑Day Habit Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    table { border-collapse: collapse; width: 100%; max-width: 1100px; margin: 0 auto; }
    th, td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: center;
      font-size: 12px;
    }
    th.habit-col, td.habit-col { text-align: left; background: #f5f0fa; }
    tr.header-week { background: #f5f0fa; font-weight: bold; }
    tr.header-daynums { background: #fafafa; }
    tr.summary { background: #f0f0f0; font-weight: bold; }
    .habit-name {
      width: 100%;
      box-sizing: border-box;
      border: none;
      background: transparent;
      font-size: 12px;
    }
    #chart-wrapper {
      max-width: 1100px;
      margin: 30px auto;
      border: 1px solid #ccc;
      padding: 10px;
    }
    #chart {
      width: 100%;
      height: 250px;
      background: #fafafa;
    }
  </style>
</head>
<body>
  <h1>21‑Day Habit Tracker</h1>

  <table id="habit-table">
    <tr class="header-week">
      <th class="habit-col">Daily Habits</th>
      <th colspan="7">Week 1</th>
      <th colspan="7">Week 2</th>
      <th colspan="7">Week 3</th>
    </tr>
    <tr class="header-daynums">
      <th class="habit-col"></th>
      <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th>
      <th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th>
      <th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th>
    </tr>
    <tbody id="habit-rows"></tbody>
    <tr class="summary">
      <td class="habit-col">Task completed</td>
      <td colspan="21"></td>
    </tr>
    <tr class="summary" id="percent-row">
      <td class="habit-col">% completed</td>
      <td colspan="21"></td>
    </tr>
  </table>

  <div id="chart-wrapper">
    <svg id="chart"></svg>
  </div>

  <script>
    const NUM_HABITS = 10;
    const NUM_DAYS = 21;
    const STORAGE_KEY = 'habitTracker21'; // each user/browser gets its own

    const habitsTbody = document.getElementById('habit-rows');
    const percentRow = document.getElementById('percent-row');

    // Load saved data (if any)
    let saved = null;
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      saved = raw ? JSON.parse(raw) : null;
    } catch (e) {
      saved = null;
    }

    // Default structure
    if (!saved) {
      saved = {
        habitNames: Array.from({ length: NUM_HABITS }, (_, i) => 'habit ' + (i + 1)),
        checks: Array.from({ length: NUM_HABITS }, () =>
          Array.from({ length: NUM_DAYS }, () => false)
        )
      };
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
    }

    // 1. build habit rows with editable names + checkboxes
    for (let h = 1; h <= NUM_HABITS; h++) {
      const tr = document.createElement('tr');

      // editable habit name
      const habitCell = document.createElement('td');
      habitCell.className = 'habit-col';
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'habit-name';
      input.value = saved.habitNames[h - 1];
      input.addEventListener('input', () => {
        saved.habitNames[h - 1] = input.value;
        saveData();
      });
      habitCell.appendChild(input);
      tr.appendChild(habitCell);

      // checkboxes for 21 days
      for (let d = 1; d <= NUM_DAYS; d++) {
        const td = document.createElement('td');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.dataset.day = d;
        cb.dataset.habit = h;
        cb.checked = !!saved.checks[h - 1][d - 1];
        cb.addEventListener('change', () => {
          saved.checks[h - 1][d - 1] = cb.checked;
          saveData();
          updateAll();
        });
        td.appendChild(cb);
        tr.appendChild(td);
      }
      habitsTbody.appendChild(tr);
    }

    // 2. add cells for "Task completed" and "% completed"
    const summaryRows = document.querySelectorAll('tr.summary');
    const tasksRow = summaryRows[0];
    const tasksCells = [];
    const percentCells = [];

    tasksRow.removeChild(tasksRow.lastElementChild);
    percentRow.removeChild(percentRow.lastElementChild);

    for (let d = 1; d <= NUM_DAYS; d++) {
      const td1 = document.createElement('td');
      td1.textContent = '0';
      tasksRow.appendChild(td1);
      tasksCells.push(td1);

      const td2 = document.createElement('td');
      td2.textContent = '0%';
      percentRow.appendChild(td2);
      percentCells.push(td2);
    }

    function computeDailyStats() {
      const stats = [];
      for (let d = 1; d <= NUM_DAYS; d++) {
        let done = 0;
        const checkboxes = document.querySelectorAll(
          'input[type="checkbox"][data-day="' + d + '"]'
        );
        checkboxes.forEach(cb => { if (cb.checked) done++; });
        const percent = Math.round((done / NUM_HABITS) * 100);
        stats.push({ done, percent });
      }
      return stats;
    }

    function updateAll() {
      const stats = computeDailyStats();
      stats.forEach((s, index) => {
        tasksCells[index].textContent = s.done;
        percentCells[index].textContent = s.percent + '%';
      });
      drawChart(stats.map(s => s.percent));
    }

    const svg = document.getElementById('chart');

    function drawChart(percentages) {
      const width = svg.clientWidth || svg.parentElement.clientWidth;
      const height = svg.clientHeight || 250;
      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
      svg.innerHTML = '';

      if (percentages.length === 0) return;

      const maxY = 100;
      const stepX = width / (percentages.length - 1 || 1);

      let path = '';
      percentages.forEach((p, i) => {
        const x = i * stepX;
        const y = height - (p / maxY) * height;
        path += (i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`);
      });
      path += ` L ${width} ${height} L 0 ${height} Z`;

      const area = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      area.setAttribute('d', path);
      area.setAttribute('fill', '#cfead5');
      area.setAttribute('stroke', '#6cc48c');
      area.setAttribute('stroke-width', '2');
      svg.appendChild(area);
    }

    // initial draw from saved data
    updateAll();
  </script>
</body>
</html>
